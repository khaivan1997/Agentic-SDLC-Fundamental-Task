# MCP Server Testing Strategy & Criteria

## Overview
This document outlines the testing strategy for the MCP Server module (`mcp-server/`). Testing covers both the MCP tool logic (unit tests) and the end-to-end AI agent interaction flow.

## 1. Unit Testing — MCP Tools

### Target: `TaskMcpTools.java`
**Frameworks**: JUnit 5, Mockito

**Test Cases**:

### `mcp-help`
- **Returns tool descriptions**: Verify the response contains descriptions for all 4 tools (`mcp-help`, `mcp-schema-tasks`, `mcp-tasks`, `mcp-tasks-summary`).

### `mcp-schema-tasks`
- **Returns valid JSON-Schema**: Verify the response is valid JSON containing the field names (`id`, `title`, `description`, `status`, `dueDate`), their types, and constraints (e.g., title max 100, description max 500, status enum values).
- **Schema matches Task entity**: Verify the returned schema matches the actual `Task` entity structure.

### `mcp-tasks` (Bulk Insert)
- **Insert single task**: Submit a JSON array with 1 task. Verify `TaskRepository.saveAll()` is called and the task is persisted.
- **Insert multiple tasks**: Submit a JSON array with 10 tasks. Verify all 10 are saved.
- **Insert 1000 tasks**: Submit a JSON array with 1000 tasks. Verify all 1000 are persisted (this is the primary success criterion).
- **Default status**: Submit tasks without a `status` field. Verify they default to `TODO`.
- **Invalid task (missing title)**: Submit a task with a blank title. Verify appropriate error response.
- **Return count**: Verify the response confirms how many tasks were successfully inserted.

### `mcp-tasks-summary`
- **Empty database**: Verify returns total = 0, with 0 for each status.
- **After insertion**: Insert tasks with mixed statuses. Verify the summary correctly counts total and per-status (TODO, IN_PROGRESS, DONE).
- **Counts match database**: Verify summary numbers match `TaskRepository.count()` and grouped counts.

## 2. Integration Testing — MCP Protocol

### Target: MCP Server Application
**Frameworks**: Spring Boot Test, MCP Client SDK (or manual SSE client)

**Test Cases**:
- **Server startup**: Verify the MCP server starts and exposes SSE endpoint.  
  Note: automated tests currently run on random port with H2 test DB, not fixed `8081` + PostgreSQL.
- **Tool discovery**: Connect via SSE and verify the server advertises all 4 tools with correct names and descriptions.
- **Schema retrieval**: Call `mcp-schema-tasks` via MCP protocol. Verify the returned JSON-Schema is parseable and correct.
- **Bulk insert via protocol**: Call `mcp-tasks` via MCP protocol with a batch of tasks.  
  Current automated protocol test validates batch flow with 50 tasks.
- **Summary after insert**: Call `mcp-tasks-summary` via MCP protocol. Verify counts match the inserted data.
- **Shared database verification**: After inserting tasks via MCP, verify the same tasks are visible via the main backend's `GET /api/tasks` endpoint on port `8080`.  
  Status: planned/manual acceptance check; not currently covered by automated MCP module tests.

## 3. AI Agent End-to-End Test

### Target: Full workflow from request-ext.txt
**Method**: Provide the AI agent with the MCP server URL and the following prompt:

> "Please inspect the task schema at mcp-schema-tasks. Then generate and insert 1000 diverse tasks with random statuses, titles, and due dates using the mcp-tasks tool."

**Verification Steps**:
1. Agent calls `mcp-help` → receives tool listing.
2. Agent calls `mcp-schema-tasks` → receives JSON-Schema.
3. Agent generates 1000 tasks with realistic, diverse data:
   - Random titles (varied lengths, up to 100 chars)
   - Random descriptions (some empty, some up to 500 chars)
   - Random statuses (distributed across TODO, IN_PROGRESS, DONE)
   - Random due dates (mix of past, present, future, and null)
4. Agent calls `mcp-tasks` with the 1000 tasks → receives success confirmation.
5. Agent calls `mcp-tasks-summary` → summary shows ~1000 total tasks split across statuses.
6. Manual check: Open React frontend at `localhost:8080` and verify new tasks appear in the UI.

## 4. Success Criteria (mapped from request-ext.txt)

| # | Criterion | Test Coverage |
|---|---|---|
| 1 | MCP Server running + respects spec 2025-06-18 | Integration: startup + discovery, plus protocol handshake test (`-Dmcp.handshake.test=true`) |
| 2 | Schema inspection works | Unit: schema content, Integration: protocol call |
| 3 | AI agent inserts 1000 records | E2E/manual flow required; automated tests currently verify smaller batches |
| 4 | Summary reflects inserted data | Unit: count accuracy, E2E: post-insert verification |
| 5 | All actions documented | Deliverable: README.md with prompts, output, results |

## 5. Execution
Unit and integration tests run via Maven:
`./backend/mvnw -f pom.xml -pl mcp-server clean test`.

For protocol-level MCP handshake/discovery/call validation (real `initialize`, `tools/list`, `tools/call` over SSE), run:
`./backend/mvnw -f pom.xml -pl mcp-server -Dmcp.handshake.test=true test`
